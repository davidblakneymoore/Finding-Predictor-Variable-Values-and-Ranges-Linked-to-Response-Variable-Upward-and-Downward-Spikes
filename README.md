# Finding Predictor Variable Values and Ranges Linked to Response Variable Upward and Downward Spikes

The function in this repository (`Determining_Predictor_Variable_Values_and_Ranges_of_Values_Corresponding_to_Upward_and_Downward_Spikes_in_Response_Variable_Values`), found [here](https://github.com/davidblakneymoore/Finding-Predictor-Variable-Values-and-Ranges-Linked-to-Response-Variable-Upward-and-Downward-Spikes/blob/main/A%20Function%20for%20Determining%20Predictor-Variable%20Values%20and%20Ranges%20of%20Values%20Corresponding%20to%20Upward%20and%20Downward%20Spikes%20in%20Response-Variable%20Values.r), is used to identify specific predictor-variables values and ranges of predictor-variable values that correspond to positive and negative spikes in response-variable values.

For example, [here](https://raw.githubusercontent.com/davidblakneymoore/Finding-Predictor-Variable-Values-and-Ranges-Linked-to-Response-Variable-Upward-and-Downward-Spikes/refs/heads/main/Sugar%20Maple%20Wood%20Temperature%20and%20Sap%20Flow%20Figure.jpeg) is a figure depicting the relationship between wood temperature (the predictor variable) and sap flow (the response variable). These data come from February of 2023 from a sugar maple (*Acer saccharum*) during winter dormancy located in Durham, New Hampshire, and are from breast height at a sapwood depth of 1 cm beneath the bark. It's evident that a substantial amount of sap flow occurs near the freezing point of water (0 Ëš C), but can the precise value at which sap flow is maximized in both the upward (positive) and downward (negative) directions be determined mathematically? Furthermore, can ranges of wood temperatures be extracted from this plot that correspond to significant sap flows in both directions?

To determine the critical wood temperature values - the wood temperature values associated with maximal positive and negative sap flows - we use an iterative, least-squares approach. [This figure](https://raw.githubusercontent.com/davidblakneymoore/Finding-Predictor-Variable-Values-and-Ranges-Linked-to-Response-Variable-Upward-and-Downward-Spikes/refs/heads/main/Finding%20Specific%20Predictor-Variable%20Values%20Associated%20With%20Positive%20and%20Negative%20Spikes%20in%20Response-Variable%20Values.jpeg) depicts the method. First, the data are split by positive and negative response-variable values. Next, a sequence of equally spaced horizontal-axis values are generated from the minimum to the maximum predictor-variable value (more values are better; the number of horizontal-axis-value increments is specified by the `Number_of_Predictor_Variable_Increments` argument of the `Determining_Predictor_Variable_Values_and_Ranges_of_Values_Corresponding_to_Upward_and_Downward_Spikes_in_Response_Variable_Values` function, which has the default value of `1000`). Then, a sequence of angles are generated between `0` and `2 / pi` rad (again, more values are better; the number of angle increments is specified by the `Number_of_Angle_Increments` argument of the `Determining_Predictor_Variable_Values_and_Ranges_of_Values_Corresponding_to_Upward_and_Downward_Spikes_in_Response_Variable_Values` function, which has the default value of `100`). These angles correspond to the two solid black lines in the example figure for this method. For each combination of horizontal-axis value and angle, data are filtered to include either only points falling between these two lines (these points are red in the example figure) or points falling outside of these two lines (these points are green in the figure). Although the example figure depicts both the predictor variable and the response variable in their original units, this algorithm converts both variables to z scores (separately) internally to ensure that they are both standardized and thus on the same scale. Next, the sum of squared residuals is calculated for both red and green points separately - the horizontal distance between the red points and the bold, dashed, vertical red line are calculated, squared, and summed, and similarly, the vertical distance between the green points and the bold, dashed, horizontal green line are calculated, squared, and summed. These two sums of squares are themselves summed, and this overall sum of squares represents the overall ability of the particular combination of horizontal-axis coordinate and angle to describe the system. After this process is carried out for each combination of horizontal-axis coordinate and angle, the combination with the least sum of squares is chosen, and the 'critical value' is deemed to be the hortizontal-axis variable associated with this combination.

To determine ranges of wood temperatures associated with significant sap flows, we first discretize wood temperatures by grouping them into bins of equal width. [This figure](https://raw.githubusercontent.com/davidblakneymoore/Finding-Predictor-Variable-Values-and-Ranges-Linked-to-Response-Variable-Upward-and-Downward-Spikes/refs/heads/main/Finding%20Ranges%20of%20Predictor-Variable%20Values%20Associated%20With%20Positive%20and%20Negative%20Spikes%20in%20Response-Variable%20Values.jpeg) depicts this method; again, this method is performed on both positive and negative response-variables separately to account for the possibility that different mechanisms drive positive and negative response-variable values. These bins are delineated by the vertical red lines in this example figure under the 'Step 1' heading, and the number of bins is specified by the `Number_of_Bins` argument of the `Determining_Predictor_Variable_Values_and_Ranges_of_Values_Corresponding_to_Upward_and_Downward_Spikes_in_Response_Variable_Values` function (the default value for this argument is `100`). Next, for each bin separately, the 95<sup>th</sup> percentile of the response-variable values are estimated (`0.95` is the default value for the `Threshold_1` argument of the `Determining_Predictor_Variable_Values_and_Ranges_of_Values_Corresponding_to_Upward_and_Downward_Spikes_in_Response_Variable_Values` function, and it can be changed if other percentiles are desired). These quantiles are represented in the example figure as the shaded regions under the 'Step 3' heading. Then, these values associated with the 95<sup>th</sup> percentile of each bin are themselves compiled, and the 95<sup>th</sup> percentile of these percentiles (again, `0.95` is the default value for the `Threshold_2` argument of the `Determining_Predictor_Variable_Values_and_Ranges_of_Values_Corresponding_to_Upward_and_Downward_Spikes_in_Response_Variable_Values` function, and it can be changed if other percentiles are desired) are determined. Bins which exceed this 95<sup>th</sup> percentile of percentiles (the tallest 5 % of the shaded regions) are represented by the darkest-shaded regions in the example figure under the 'Step 4' heading. Finally, the endpoints of these bins are extracted and reported as the ranges of wood temperatures associated with the most significant sap flows (the endpoint values of these ranges are visible under the 'Step 5' heading in the figure). This method is capable of identifying multiple different (discrete) ranges of predictor-variable values associated with significant response-variable values (for example, [this figure](https://raw.githubusercontent.com/davidblakneymoore/Finding-Predictor-Variable-Values-and-Ranges-Linked-to-Response-Variable-Upward-and-Downward-Spikes/refs/heads/main/Sugar%20Maple%20Wood%20Temperature%20and%20Sap%20Flow%20Figure%20(Using%20100%20Wood-Temperature%20Bins).jpeg) depicts how the algorithm outlined here handled the sugar maple data frame introduced earlier).

Smaller horizontal-axis value increments and angle increments for the algorithm used to identify specific predictor-variable values and smaller bins for the algorithm used to identify ranges of predictor-variable values lead to more accurate estimations but increase the computational intensity. Larger data sets also increase accuracy and computational intensity simultaneously.

In syrup production and tree physiology, it is theorized that specific temperatures or ranges of temperature are associated with stem pressures and sap flows during winter dormancy for different types of trees such as maples, birches, and walnuts. For example, sugar maple sap yields are associated with freeze-thaw cycles, and most of the pressure generated and dissipated in the sapwood has its genesis at temperatures between the freezing point of pure water and the freezing point of sap. Birch sap yields are associated with slightly warmer temperatures that typically do not involve freezing and thawing. It's thought that sugar and starch interconversion catalyzed by enzymes may play a role in these pressurization events in birches and walnuts, so perhaps the wood temperatures associated with sap flow and stem pressure in those species are related to the optimal temperatures for these enzymes, although because these processes occur on a whole-tree scale and measurements are taken at specific points (often near breast height), there will likely be quite a bit of noise in the data, and specific critical temperatures may not be elucidated using measurements from only a specific point. The method and algorithm described here, though, are still useful and may be used to approximate these specific temperatures and temeprature ranges.

Under ideal conditions (where temperatures vary monotonically and entirely across these temperature ranges), it's possible that a [1<sup>st</sup>-order Hermite function](https://en.wikipedia.org/wiki/Hermite_polynomials#Hermite_functions) may be used to model the relationship between wood temperature and sap flow and the relationship between wood temperature and stem pressure (shown in [this figure](https://raw.githubusercontent.com/davidblakneymoore/Finding-Predictor-Variable-Values-and-Ranges-Linked-to-Response-Variable-Upward-and-Downward-Spikes/refs/heads/main/First-Order%20Hermite%20Function.jpeg), where a horizontal red line depicts no sap flow and a vertical green line depicts a critical wood temperature of `0`), although with noisy field data, more approximate methods may be more appropriate. Under these idealized conditions, where temperatures vary monotonically and entirely across these temperature ranges, the response of either sap flow or stem pressure to wood temperature would likely be relatively consistent for specific wood temperatures, although when temperatures do not vary monotonically or do not vary entirely across these temperature ranges, it's likely that the response of sap flow or stem pressure to wood temperature would not be always be consistent (showing either only positive or negative values) for specific wood temperatures.

The R code for all of these example figures are available [here](https://github.com/davidblakneymoore/Finding-Predictor-Variable-Values-and-Ranges-Linked-to-Response-Variable-Upward-and-Downward-Spikes/blob/main/A%20Function%20for%20Determining%20Predictor-Variable%20Values%20and%20Ranges%20of%20Values%20Corresponding%20to%20Upward%20and%20Downward%20Spikes%20in%20Response-Variable%20Values%20-%20Explanation%20and%20Examples.r).
